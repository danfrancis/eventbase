<div class="header span12">
  <div class="logo">
    <h1><%= link_to 'EventBase', root_url %></h1>
  </div>
  <div class="header-nav">
    <% if current_user %>
      <ul class="nav-signed-in">
        <% if !action_name.include?('home') %>
          <li>
            <div class="btn-group">
              <%= render partial: 'pages/search', locals: { width: 'span3' } %>
            </div>
          </li>
          <li>
            <div class="btn-group span1">
            </div>
          </li>
        <% end %>
        <% if @lists.any? %>
          <li>
            <div class="btn-group">
              <a id="sign_in" class="btn dropdown-toggle" data-toggle="dropdown" href="#">
                Calendar
                <span class="caret"></span>
              </a>
              <ul class="dropdown-menu">
                <% if @lists.by_type('Event').any? %>
                  <li><%= link_to 'Events', '/dashboard?type=Event' %></li>
                <% else %>
                  <li>No 'Event' lists yet.</li>
                <% end %>
                <% if @lists.by_type('Company').any? %>
                  <li><%= link_to 'Companies', '/dashboard?type=Company' %></li>
                <% else %>
                  <li>No 'Company' lists yet.</li>
                <% end %>
              </ul>
            </div>
          </li>
        <% end %>
        <li>
          <div class="btn-group">
            <%= link_to 'Settings', user_url(current_user), class: 'btn' %>
          </div>
        </li>
        <li>
          <div class="btn-group">
            <%= link_to 'Sign out', sessions_url, class: 'btn', method: :delete %>
          </div>
        </li>
      </ul>
    <% else %>
      <ul class="nav-signed-out">
        <li>
          <div class="btn-group">
            <a class="btn" href="#">Pricing</a>
          </div>
        </li>
        <li>
          <div class="btn-group">
            <a id="sign_in" class="btn dropdown-toggle" data-toggle="dropdown" href="#">
              Sign In
              <span class="caret"></span>
            </a>
            <ul class="dropdown-menu">
            <%= form_tag(sessions_url) do %>
              <li><%= text_field_tag :email, nil, placeholder: 'Email' %></li>
              <li><%= password_field_tag :password, nil, placeholder: 'Password' %></li>
              <li><%= submit_tag 'Sign In', class: 'btn-primary' %></li>
            <% end %>
            </ul>
          </div>
        </li>
        <li>
          <div class="btn-group">
            <a id="sign_up" class="btn dropdown-toggle" data-toggle="dropdown" href="#">
              Sign Up
              <span class="caret"></span>
            </a>
            <ul class="dropdown-menu">
              <%= render 'users/form' %>
            </ul>
          </div>
        </li>
      </ul>
    <% end %>
  </div>
</div>

<style>
.ui-autocomplete-category {
    font-weight: bold;
    padding: .2em .4em;
    margin: .8em 0 .2em;
    line-height: 1.5;
}
</style>
<script>
$.widget( "custom.catcomplete", $.ui.autocomplete, {
    _renderMenu: function( ul, items ) {
        var that = this,
            currentCategory = "";
        $.each( items, function( index, item ) {
            if ( item.category != currentCategory ) {
                ul.append( "<li class='ui-autocomplete-category'>" + item.category + "</li>" );
                currentCategory = item.category;
            }
            that._renderItemData( ul, item );
        });
    }
});
</script>


<script>

  $(function(){
    var companies_events_lists = [
    <% @companies_events_lists.each do |item| %>
      { category: '<%= j(item.class.name) %>', label: '<%= j(item.name) %>', url: '<%= "#{item.class.name.downcase.pluralize}/#{item.id}" %>' }
      <% if item != @companies_events_lists.last %>,<% end %>
    <% end %>
    ];

    $("#search").catcomplete({ 
      source: companies_events_lists,
      select: function(event, ui){
        window.location.replace('<%= j(root_url) %>' + ui.item['url']);
      }
    });
    
    $('#sign_in').on('click', function(){
      setTimeout('$("#email").focus()', 300);
    });
    
    $('#sign_up').on('click', function(){
      setTimeout('$("#user_first_name").focus()', 300);
    });
    
  });

</script>