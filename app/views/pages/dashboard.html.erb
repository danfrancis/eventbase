<div class="dashboard">
  <div class="accordion span3" id="accordion2">
    <div class="accordion-group">
      <%= render partial: 'lists', locals: { lists: @lists } %>
    </div>
    <div class="accordion-group">
      <%= render partial: 'events', locals: {} %>
    </div>
    <div class="accordion-group">
      <div class="accordion-heading">
        <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseThree">
          Filters by Category
        </a>
      </div>
      <div id="collapseThree" class="accordion-body collapse">
        <div class="accordion-inner">
          <% @sectors.each do |sector| %>
            <p>
              <%= check_box_tag :sector, nil, false, class: 'category_filter', id: "#{sector.name}" %>
              <span><%= sector.name %></span>
            </p>
          <% end %>
        </div>
      </div>
    </div>
  </div>
  <div class="dashboard-results span8">
    <ul id="myTab" class="nav nav-tabs">
      <li class="active"><a href="#events" data-toggle="tab">Events</a></li>
      <li><a href="#companies" data-toggle="tab">Companies</a></li>
    </ul>
    <div id="myTabContent" class="tab-content">
      <div class="tab-pane fade in active" id="events">
        <div id="calendar"></div>
      </div>
      <div class="tab-pane fade" id="companies">
        <p>Companies show here</p>
      </div>
    </div>
  </div>
</div>

<script>

  var lists = ["Fun"];
  
  var events = [
  <% @events.each do |event| %>
    <% if event.event_start_date && event.event_end_date %>
      {
        id: <%= event.id %>,
        title: '<%= event.name %>',
        start: new Date(<%= event.start_year %>, <%= event.start_month %>, <%= event.start_day %>),
        end: new Date(<%= event.end_year %>, <%= event.end_month %>, <%= event.end_day %>),
        categories: '<%= event.sector_names %>',
        show: true
      }
    <% if event != @events.last %>,<% end %>
    <% end %>
  <% end %>
  ];
  
  var arr = [];


  $(function(){
    
    $("#lists").typeahead({ source: lists });
    
    $('#calendar').fullCalendar({
        // your options here
        header: {
  				left: 'prev,next today',
  				center: 'title',
  				right: 'month,basicWeek,basicDay'
  			},
        defaultView: 'month',
        events: events,
        eventClick: function(calEvent, jsEvent, view) {
          window.location.replace('<%= root_url %>events/'+calEvent.id);
        }
    });
    
    $('.category_filter').click(function(){
      var category = $(this).attr('id');
      arr = [];
      for(var i=0; i < events.length; i++){
        if(events[i]['categories'].indexOf(category) == -1){
          arr.push(events[i]['id']);
        }
      }
      for(var i=0; i < arr.length; i++){
        $('#calendar').fullCalendar( 'removeEvents', arr[i]);
      }
      $('#calendar').fullCalendar( 'removeEventSource', events );
      $('#calendar').fullCalendar( 'addEventSource', arr );
    });
  });


</script>